<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- JAVA와 연결할 Mapper 파일 설정 -->
<mapper namespace="kopo.poly.persistance.mapper.IUserInfoMapper">

	<!-- 회원가입하기(회원정보 등록하기) -->
	<insert id="insertUserInfo" parameterType="UserInfoDTO">
		INSERT INTO USER_INFO
			(
			 	USER_EMAIL,
			 	USER_NAME,
			 	PASSWORD,
			 	AGE,
			 	SEX,
			 	USER_ID,
			 	TLV_INT
			)
			VALUES(
				   #{user_email},
				   #{user_name},
				   #{password},
				   #{age},
				   #{sex},
				   #{user_id},
			       #{tlv_int}
				  )
	</insert>

	<!-- 이메일로 회원 가입 중복 방지하기 -->
	<select id="getUserExists" parameterType="UserInfoDTO" resultType="UserInfoDTO">
		SELECT (CASE WHEN COUNT(1) THEN 'Y' ELSE 'N' END )AS EXISTS_YN
			FROM USER_INFO
		WHERE USER_EMAIL = #{user_email}
	</select>

	<!---회원가입 로그인하기  -->
	<select  id="getUserLoginCheck"  parameterType="UserInfoDTO" resultType="UserInfoDTO">
		SELECT USER_SEQ,USER_EMAIL,USER_NAME, USER_ID
			FROM USER_INFO WHERE USER_EMAIL = #{user_email} AND PASSWORD = #{password}
			</select>
	<!--사용자 아이디찾기-->
	<select id="findUserId" parameterType="UserInfoDTO"
			resultType="UserInfoDTO">
		SELECT USER_NAME,USER_EMAIL
		FROM USER_INFO
		WHERE USER_NAME= #{user_name} AND AGE= #{age}
	</select>

	<!--사용자 비밀번호변경-->
	<update id="updateUserPw" parameterType="UserInfoDTO">
		UPDATE USER_INFO
		SET PASSWORD = #{password}
		WHERE USER_NAME = #{user_name} AND USER_EMAIL = #{user_email}
	</update>

	<!-- 유저 정보 변경  -->
	<update id="UpdateUserPage" parameterType="UserInfoDTO">
	UPDATE USER_INFO
	SET USER_NAME = #{user_name},
		USER_EMAIL = #{user_email},
		AGE = #{age},
		SEX = #{sex}
	WHERE USER_EMAIL = #{user_email}
	</update>

	<!--사용자 마이페이지 정보가져오기 -->
	<select  id="getUserInfo"  parameterType="UserInfoDTO" resultType="UserInfoDTO">
	SELECT USER_NAME, PASSWORD, USER_EMAIL, AGE, SEX, TLV_INT
	FROM USER_INFO
	WHERE USER_EMAIL = #{user_email}
	</select>

	<!-- 회원탈퇴  -->
	<delete parameterType="UserInfoDTO" id="deleteUserInfo">
	DELETE FROM USER_INFO
	WHERE USER_EMAIL = #{user_email} </delete>

	<insert id="addFriend" parameterType="FriendDTO">
		INSERT INTO FRIEND
		(
			USER_SEQ,
		 	RECEIVE_USER,
		 	VALUE

		)
		VALUES (
		    #{user_seq},
		    #{receive_user},
		    "0"
		)
	</insert>
	<select id="getFriendList" parameterType="FriendDTO" resultType="UserInfoDTO">
		SELECT
			A.user_seq,
			A.user_name,
			B.value,
			A.user_email
		FROM yuDB.USER_INFO A
				 INNER JOIN yuDB.FRIEND B
							ON A.user_seq = B.user_seq and B.RECEIVE_USER = #{receive_user}
	</select>

	<update id="friendCheck" parameterType="FriendDTO">
		UPDATE FRIEND
		SET VALUE = 1
		WHERE USER_SEQ = #{user_seq} AND RECEIVE_USER = #{receive_user}
	</update>

	<select id="getFriendList2" parameterType="FriendDTO" resultType="UserInfoDTO">
		SELECT
			A.user_seq,
			A.user_name,
			B.value
		FROM yuDB.USER_INFO A
				 INNER JOIN yuDB.FRIEND B
							ON A.user_seq = B.user_seq and B.RECEIVE_USER = #{receive_user} and B.VALUE = 1
	</select>
</mapper>